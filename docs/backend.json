{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the AlgoGenius platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., Educator, Student)."
        },
        "profileData": {
          "type": "string",
          "description": "A reference to the user's profile data. (Relationship: User 1:1 UserProfile)"
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "profileData"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Stores profile information for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "User's date of birth.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName"
      ]
    },
    "Scenario": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Scenario",
      "type": "object",
      "description": "Represents a programming scenario generated by the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the scenario."
        },
        "theme": {
          "type": "string",
          "description": "Theme of the scenario (e.g., Adventure/Fantasy, Sci-Fi)."
        },
        "content": {
          "type": "string",
          "description": "The generated scenario content."
        },
        "difficulty": {
          "type": "string",
          "description": "Difficulty level of the scenario (e.g., Easy, Medium, Hard)."
        },
        "dsaConcept": {
          "type": "string",
          "description": "DSA concept guidance in the generated scenario."
        }
      },
      "required": [
        "id",
        "theme",
        "content",
        "difficulty"
      ]
    },
    "Assignment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Assignment",
      "type": "object",
      "description": "Represents an assignment given to a student.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the assignment."
        },
        "educatorId": {
          "type": "string",
          "description": "Reference to the Educator who created the assignment. (Relationship: Educator 1:N Assignment)"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to the Student assigned to the assignment. (Relationship: Student 1:N Assignment)"
        },
        "scenarioId": {
          "type": "string",
          "description": "Reference to the Scenario used in the assignment. (Relationship: Scenario 1:N Assignment)"
        },
        "dueDate": {
          "type": "string",
          "description": "Due date for the assignment.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the assignment (e.g., Assigned, In Progress, Completed)."
        }
      },
      "required": [
        "id",
        "educatorId",
        "studentId",
        "scenarioId",
        "dueDate",
        "status"
      ]
    },
    "Hint": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hint",
      "type": "object",
      "description": "Represents a hint for a specific scenario.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the hint."
        },
        "scenarioId": {
          "type": "string",
          "description": "Reference to the Scenario this hint belongs to. (Relationship: Scenario 1:N Hint)"
        },
        "hintLevel": {
          "type": "number",
          "description": "The level of the hint (e.g., 1, 2, 3)."
        },
        "content": {
          "type": "string",
          "description": "The content of the hint."
        }
      },
      "required": [
        "id",
        "scenarioId",
        "hintLevel",
        "content"
      ]
    },
    "TestCase": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TestCase",
      "type": "object",
      "description": "Represents a test case for a programming scenario.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the test case."
        },
        "scenarioId": {
          "type": "string",
          "description": "Reference to the Scenario this test case belongs to. (Relationship: Scenario 1:N TestCase)"
        },
        "input": {
          "type": "string",
          "description": "The input for the test case."
        },
        "output": {
          "type": "string",
          "description": "The expected output for the test case."
        },
        "explanation": {
          "type": "string",
          "description": "Explanation of the test case."
        },
        "isEdgeCase": {
          "type": "boolean",
          "description": "Indicates if this is an edge case."
        }
      },
      "required": [
        "id",
        "scenarioId",
        "input",
        "output"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user account information. Includes 'userId' as document ID for easy access and management.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile details related to an account. The document ID will be the same as the userId. This enforces a 1:1 relation between Users and UserProfiles.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/scenarios/{scenarioId}",
        "definition": {
          "entityName": "Scenario",
          "schema": {
            "$ref": "#/backend/entities/Scenario"
          },
          "description": "Stores programming scenarios generated by the system. Accessible to all users.",
          "params": [
            {
              "name": "scenarioId",
              "description": "The unique identifier of the scenario."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/assignments/{assignmentId}",
        "definition": {
          "entityName": "Assignment",
          "schema": {
            "$ref": "#/backend/entities/Assignment"
          },
          "description": "Stores assignments assigned to a user.  This uses path-based ownership for simplified security rules. Includes 'educatorId' and 'studentId' fields for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user (student)."
            },
            {
              "name": "assignmentId",
              "description": "The unique identifier of the assignment."
            }
          ]
        }
      },
      {
        "path": "/scenarios/{scenarioId}/hints/{hintId}",
        "definition": {
          "entityName": "Hint",
          "schema": {
            "$ref": "#/backend/entities/Hint"
          },
          "description": "Stores hints related to a specific scenario.",
          "params": [
            {
              "name": "scenarioId",
              "description": "The unique identifier of the scenario."
            },
            {
              "name": "hintId",
              "description": "The unique identifier of the hint."
            }
          ]
        }
      },
      {
        "path": "/scenarios/{scenarioId}/testCases/{testCaseId}",
        "definition": {
          "entityName": "TestCase",
          "schema": {
            "$ref": "#/backend/entities/TestCase"
          },
          "description": "Stores test cases for a specific scenario.",
          "params": [
            {
              "name": "scenarioId",
              "description": "The unique identifier of the scenario."
            },
            {
              "name": "testCaseId",
              "description": "The unique identifier of the test case."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the AlgoGenius platform, emphasizing secure and scalable data management for users, scenarios, assignments, hints, and test cases. The structure prioritizes authorization independence, clarity, and predictable security rules. This design adheres to the specified principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and Rules Are Not Filters. \n\n**Authorization Independence:** Authorization is primarily achieved through path-based ownership and denormalization.  For example, assignments are stored under `/users/{userId}/assignments/{assignmentId}` facilitating straightforward ownership checks without requiring `get()` calls.  Fields like `educatorId` and `studentId` within the Assignment document ensure that the necessary information for authorization is available locally, avoiding hierarchical dependencies.\n\n**Structural Segregation:** Data with different access requirements are stored in separate collections. User profiles and data are kept under `/users/{userId}`, while scenarios are stored in a separate `/scenarios` collection. This segregation simplifies security rules by ensuring that each collection has a homogeneous security posture.\n\n**Access Modeling:** Private user data is stored using path-based ownership under the `/users/{userId}` collection.  Assignments, hints and test cases are stored as subcollections under Scenarios or Users, depending on the ownership and sharing requirements.  Collaborative access is handled through direct ownership. Scenarios are globally accessible (since they are system-generated) and can be referenced by IDs in assignments.\n\n**QAPs (Rules are not Filters):** The structure allows for secure listing operations. By storing assignments under `/users/{userId}/assignments/{assignmentId}`, listing assignments for a specific user only requires querying this collection, which is inherently secure due to the path-based ownership. Separate collections for scenarios and user profiles further enhance the ability to apply specific security rules to different data types.\n\n**Invariants:** The structure supports integrity constraints by leveraging path-based ownership and server-side timestamping. Ownership is enforced through the document path (e.g., `/users/{userId}/assignments/{assignmentId}` ensures the assignment belongs to the specified user)."
  }
}