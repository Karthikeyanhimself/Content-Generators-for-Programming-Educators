{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the AlgoGenius platform, including their profile information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user, matches auth UID."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., Educator, Student).",
          "enum": ["student", "educator"]
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "academicLevel": {
            "type": "string",
            "description": "The academic level of the student (e.g., High School, University)."
        },
        "learningGoals": {
            "type": "string",
            "description": "The student's personal learning goals, which can be updated by the AI."
        },
        "preferredProgrammingLanguages": {
            "type": "array",
            "items": { "type": "string" },
            "description": "A list of the student's preferred programming languages."
        },
        "hasCompletedAssessment": {
          "type": "boolean",
          "description": "Flag indicating if the student has completed the initial knowledge assessment."
        },
        "subjectSpecialization": {
            "type": "string",
            "description": "The educator's area of specialization."
        },
        "yearsOfExperience": {
            "type": "number",
            "description": "The educator's years of teaching experience."
        },
        "institution": {
            "type": "string",
            "description": "The institution the educator is affiliated with."
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "firstName"
      ]
    },
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student in an educator's roster.",
      "properties": {
        "uid": { "type": "string", "description": "The student's user ID." },
        "email": { "type": "string", "description": "The student's email." },
        "firstName": { "type": "string", "description": "The student's first name." },
        "lastName": { "type": "string", "description": "The student's last name." },
        "addedAt": { "type": "string", "format": "date-time", "description": "Timestamp when the student was added." }
      },
      "required": ["uid", "email", "firstName", "lastName", "addedAt"]
    },
    "Scenario": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Scenario",
      "type": "object",
      "description": "Represents a programming scenario generated by the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the scenario."
        },
        "theme": {
          "type": "string",
          "description": "Theme of the scenario (e.g., Adventure/Fantasy, Sci-Fi)."
        },
        "content": {
          "type": "string",
          "description": "The generated scenario content."
        },
        "difficulty": {
          "type": "string",
          "description": "Difficulty level of the scenario (e.g., Easy, Medium, Hard)."
        },
        "dsaConcept": {
          "type": "string",
          "description": "DSA concept guidance in the generated scenario."
        }
      },
      "required": [
        "id",
        "theme",
        "content",
        "difficulty"
      ]
    },
    "Assignment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Assignment",
      "type": "object",
      "description": "Represents an assignment given to a student, including their submission.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the assignment." },
        "educatorId": { "type": "string", "description": "ID of the Educator who created the assignment. 'SYSTEM' if AI-generated." },
        "studentId": { "type": "string", "description": "ID of the Student assigned." },
        "scenarioId": { "type": "string", "description": "ID of the Scenario used." },
        "dueDate": { "type": "string", "format": "date-time", "description": "Due date for the assignment." },
        "status": { "type": "string", "description": "Status (e.g., Assigned, In Progress, Completed).", "enum": ["assigned", "completed", "draft"] },
        "dsaConcept": { "type": "string", "description": "The primary DSA concept for the assignment." },
        "solutionCode": { "type": "string", "description": "The code submitted by the student." },
        "score": { "type": "number", "description": "The score (0-100) from AI assessment." },
        "feedback": { "type": "string", "description": "AI-generated feedback on the submission." },
        "submittedAt": { "type": "string", "format": "date-time", "description": "Timestamp of submission." },
        "isAutonomouslyGenerated": { "type": "boolean", "description": "True if this assignment was created automatically by the AI agent." }
      },
      "required": [ "id", "educatorId", "studentId", "scenarioId", "dueDate", "status" ]
    },
    "StudentSubmission": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StudentSubmission",
      "type": "object",
      "description": "Represents a denormalized student submission for easier querying by educators.",
      "properties": {
        "studentId": { "type": "string", "description": "ID of the Student who submitted." },
        "studentEmail": { "type": "string", "description": "Email of the Student." },
        "studentName": { "type": "string", "description": "Full name of the Student." },
        "originalAssignmentId": { "type": "string", "description": "ID of the original assignment in the student's collection." },
        "dsaConcept": { "type": "string", "description": "The primary DSA concept for the assignment." },
        "score": { "type": "number", "description": "The score (0-100) from AI assessment." },
        "feedback": { "type": "string", "description": "AI-generated feedback on the submission." },
        "solutionCode": { "type": "string", "description": "The code submitted by the student." },
        "submittedAt": { "type": "string", "format": "date-time", "description": "Timestamp of submission." }
      },
      "required": [ "studentId", "studentEmail", "studentName", "originalAssignmentId", "dsaConcept", "score", "feedback", "solutionCode", "submittedAt" ]
    },
    "Hint": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hint",
      "type": "object",
      "description": "Represents a hint for a specific scenario.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the hint."
        },
        "scenarioId": {
          "type": "string",
          "description": "Reference to the Scenario this hint belongs to. (Relationship: Scenario 1:N Hint)"
        },
        "hintLevel": {
          "type": "number",
          "description": "The level of the hint (e.g., 1, 2, 3)."
        },
        "content": {
          "type": "string",
          "description": "The content of the hint."
        }
      },
      "required": [
        "id",
        "scenarioId",
        "hintLevel",
        "content"
      ]
    },
    "TestCase": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TestCase",
      "type": "object",
      "description": "Represents a test case for a programming scenario.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the test case."
        },
        "scenarioId": {
          "type": "string",
          "description": "Reference to the Scenario this test case belongs to. (Relationship: Scenario 1:N TestCase)"
        },
        "input": {
          "type": "string",
          "description": "The input for the test case."
        },
        "output": {
          "type": "string",
          "description": "The expected output for the test case."
        },
        "explanation": {
          "type": "string",
          "description": "Explanation of the test case."
        },
        "isEdgeCase": {
          "type": "boolean",
          "description": "Indicates if this is an edge case."
        }
      },
      "required": [
        "id",
        "scenarioId",
        "input",
        "output"
      ]
    },
    "UserEmail": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserEmail",
      "type": "object",
      "description": "A mapping from a user's email to their UID.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The user's unique ID."
        }
      },
      "required": ["uid"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user account and profile information. Includes 'userId' as document ID for easy access and management.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/students/{studentId}",
        "definition": {
          "entityName": "Student",
          "schema": { "$ref": "#/backend/entities/Student" },
          "description": "Subcollection for an educator to manage their roster of students.",
           "params": [
            { "name": "userId", "description": "The educator's unique ID." },
            { "name": "studentId", "description": "The student's unique ID." }
          ]
        }
      },
      {
        "path": "/users-by-email/{email}",
        "definition": {
            "entityName": "UserEmail",
            "schema": { "$ref": "#/backend/entities/UserEmail" },
            "description": "Maps user emails to UIDs to allow educators to find students by email address without needing broad query permissions. The document ID is the user's email.",
            "params": [
                {
                    "name": "email",
                    "description": "The user's email address."
                }
            ]
        }
      },
      {
        "path": "/scenarios/{scenarioId}",
        "definition": {
          "entityName": "Scenario",
          "schema": {
            "$ref": "#/backend/entities/Scenario"
          },
          "description": "Stores programming scenarios generated by the system. Accessible to all users.",
          "params": [
            {
              "name": "scenarioId",
              "description": "The unique identifier of the scenario."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/assignments/{assignmentId}",
        "definition": {
          "entityName": "Assignment",
          "schema": {
            "$ref": "#/backend/entities/Assignment"
          },
          "description": "Stores assignments assigned to a user. This uses path-based ownership for simplified security rules. Includes 'educatorId' and 'studentId' fields for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user (student or educator for drafts)."
            },
            {
              "name": "assignmentId",
              "description": "The unique identifier of the assignment."
            }
          ]
        }
      },
      {
        "path": "/scenarios/{scenarioId}/hints/{hintId}",
        "definition": {
          "entityName": "Hint",
          "schema": {
            "$ref": "#/backend/entities/Hint"
          },
          "description": "Stores hints related to a specific scenario.",
          "params": [
            {
              "name": "scenarioId",
              "description": "The unique identifier of the scenario."
            },
            {
              "name": "hintId",
              "description": "The unique identifier of the hint."
            }
          ]
        }
      },
      {
        "path": "/scenarios/{scenarioId}/testCases/{testCaseId}",
        "definition": {
          "entityName": "TestCase",
          "schema": {
            "$ref": "#/backend/entities/TestCase"
          },
          "description": "Stores test cases for a specific scenario.",
          "params": [
            {
              "name": "scenarioId",
              "description": "The unique identifier of the scenario."
            },
            {
              "name": "testCaseId",
              "description": "The unique identifier of the test case."
            }
          ]
        }
      },
      {
        "path": "/educators/{educatorId}/submissions/{submissionId}",
        "definition": {
          "entityName": "StudentSubmission",
          "schema": {
            "$ref": "#/backend/entities/StudentSubmission"
          },
          "description": "Stores denormalized student submissions for easy querying by educators.",
          "params": [
            {
              "name": "educatorId",
              "description": "The unique identifier of the educator."
            },
            {
              "name": "submissionId",
              "description": "The unique identifier of the submission record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the AlgoGenius platform, emphasizing secure and scalable data management for users, scenarios, assignments, hints, and test cases. The structure prioritizes authorization independence, clarity, and predictable security rules. This design adheres to the specified principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and Rules Are Not Filters. \n\n**Authorization Independence:** Authorization is primarily achieved through path-based ownership and denormalization.  For example, assignments are stored under `/users/{userId}/assignments/{assignmentId}` facilitating straightforward ownership checks without requiring `get()` calls.  Fields like `educatorId` and `studentId` within the Assignment document ensure that the necessary information for authorization is available locally, avoiding hierarchical dependencies.\n\n**Structural Segregation:** Data with different access requirements are stored in separate collections. User data is kept under `/users/{userId}`, while scenarios are stored in a separate `/scenarios` collection. This segregation simplifies security rules by ensuring that each collection has a homogeneous security posture.\n\n**Access Modeling:** Private user data is stored using path-based ownership under the `/users/{userId}` collection.  Assignments, hints and test cases are stored as subcollections under Scenarios or Users, depending on the ownership and sharing requirements.  Collaborative access is handled through direct ownership. Scenarios are globally accessible (since they are system-generated) and can be referenced by IDs in assignments.\n\n**QAPs (Rules are not Filters):** The structure allows for secure listing operations. By storing assignments under `/users/{userId}/assignments/{assignmentId}`, listing assignments for a specific user only requires querying this collection, which is inherently secure due to the path-based ownership. A new denormalized collection `/educators/{educatorId}/submissions` is added for educators to easily and securely query all submissions from their students without complex, multi-collection queries, simplifying the educator dashboard experience. Separate collections for scenarios and user profiles further enhance the ability to apply specific security rules to different data types.\n\n**Invariants:** The structure supports integrity constraints by leveraging path-based ownership and server-side timestamping. Ownership is enforced through the document path (e.g., `/users/{userId}/assignments/{assignmentId}` ensures the assignment belongs to the specified user)."
  }
}

    